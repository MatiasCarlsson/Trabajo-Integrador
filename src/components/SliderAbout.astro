---
const {
  imagenes = [],
  descripcion = [],
  nombre = '',
  autoplay = false,
  autoplaySpeed = 3000,
  sliderID = 'sliderAbout',
} = Astro.props;

import '@styles/ArrowSliderAbout.css';
---

<section
  class="flex w-full flex-col items-center gap-6 md:gap-8 lg:flex-row lg:items-start lg:justify-center"
>
  <!-- Contenedor del slider -->
  <article
    id={sliderID}
    class="relative flex flex-shrink-0 items-center justify-center"
  >
    <!-- Contenedor de la imagen con controles -->
    <div class="relative">
      <div class="absolute inset-0 z-20 flex">
        <button id="prev" class="arrowPrev"></button>
        <button id="next" class="arrowNext"></button>
      </div>
      <img
        src=""
        alt=""
        id="sliderImage"
        class="size-72 rounded-lg border-8 border-white object-cover shadow-lg transition-all duration-300 sm:size-80 md:h-96 md:w-96"
      />
    </div>
  </article>

  <!-- Contenedor del texto -->
  <article
    class="flex w-full max-w-md flex-col rounded-lg bg-gray-50 p-4 shadow-md lg:max-w-lg lg:p-6 xl:max-w-xl"
  >
    <h2
      class="mb-4 border-b-2 border-bloom-accent pb-2 text-xl font-bold text-gray-800 sm:text-2xl lg:text-3xl"
    >
      Bienvenidos a Bloom
    </h2>
    <div class="flex-1">
      <p
        class="leading-relaxed text-gray-700 sm:text-base lg:text-lg"
        id="aboutText"
      >
      </p>
    </div>
    <div class="mt-4 rounded-md border-t-2 border-bloom-accent bg-white p-3">
      <p class="text-sm italic text-gray-600">Más contenido próximamente...</p>
    </div>
  </article>
</section>

<script
  define:vars={{
    imagenes,
    descripcion,
    nombre,
    autoplay,
    autoplaySpeed,
    sliderID,
  }}
>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      // Construir la ruta correcta con BASE_URL
      const baseURL =
        document.querySelector('base')?.href || window.location.origin;
      const scriptPath = baseURL.endsWith('/')
        ? `${baseURL}_astro/slider.js`
        : `${baseURL}/_astro/slider.js`;

      const module = await import(scriptPath);
      const { initSlider } = module;

      initSlider(imagenes, sliderID, {
        texts: descripcion,
        name: nombre,
        autoplay: autoplay,
        autoplaySpeed: autoplaySpeed,
        resumeAutoplay: true,
      });
    } catch (error) {
      console.error('Error al cargar el slider:', error);

      // Fallback: cargar directamente desde la carpeta scripts
      try {
        const fallbackModule = await import(
          `${baseURL}/src/scripts/components/slider.js`
        );
        const { initSlider } = fallbackModule;

        initSlider(imagenes, sliderID, {
          texts: descripcion,
          name: nombre,
          autoplay: autoplay,
          autoplaySpeed: autoplaySpeed,
          resumeAutoplay: true,
        });
      } catch (fallbackError) {
        console.error('Error en fallback del slider:', fallbackError);
      }
    }
  });
</script>
