---
const {
  imagenes = [],
  descripcion = [],
  nombre = '',
  autoplay = false,
  autoplaySpeed = 3000,
  sliderID = 'sliderAbout',
} = Astro.props;

import '@styles/ArrowSliderAbout.css';
---

<section
  class="flex w-full flex-col items-center gap-6 md:gap-8 lg:flex-row lg:items-start lg:justify-center"
>
  <!-- Contenedor del slider -->
  <article
    id={sliderID}
    class="relative flex flex-shrink-0 items-center justify-center"
  >
    <!-- Contenedor de la imagen con controles -->
    <div class="relative">
      <div class="absolute inset-0 z-20 flex">
        <button id="prev" class="arrowPrev"></button>
        <button id="next" class="arrowNext"></button>
      </div>
      <img
        src=""
        alt=""
        id="sliderImage"
        class="size-72 rounded-lg border-8 border-white object-cover shadow-lg transition-all duration-300 sm:size-80 md:h-96 md:w-96"
      />
    </div>
  </article>

  <!-- Contenedor del texto -->
  <article
    class="flex w-full max-w-md flex-col rounded-lg bg-gray-50 p-4 shadow-md lg:max-w-lg lg:p-6 xl:max-w-xl"
  >
    <h2
      class="mb-4 border-b-2 border-bloom-accent pb-2 text-xl font-bold text-gray-800 sm:text-2xl lg:text-3xl"
    >
      Bienvenidos a Bloom
    </h2>
    <div class="flex-1">
      <p
        class="leading-relaxed text-gray-700 sm:text-base lg:text-lg"
        id="aboutText"
      >
      </p>
    </div>
    <div class="mt-4 rounded-md border-t-2 border-bloom-accent bg-white p-3">
      <p class="text-sm italic text-gray-600">M치s contenido pr칩ximamente...</p>
    </div>
  </article>
</section>

<script
  define:vars={{
    imagenes,
    descripcion,
    nombre,
    autoplay,
    autoplaySpeed,
    sliderID,
  }}
>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('Iniciando slider con im치genes:', imagenes);

    if (!imagenes || !imagenes.length) {
      console.error('No se proporcionaron im치genes para el slider');
      return;
    }

    // Elementos del DOM
    const sliderContainer = document.getElementById(sliderID);
    const img = document.getElementById('sliderImage');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const aboutText = document.getElementById('aboutText');

    if (!sliderContainer || !img || !prevBtn || !nextBtn) {
      console.error('No se encontraron todos los elementos necesarios para el slider');
      return;
    }

    let currentIndex = 0;
    const isSimpleArray = typeof imagenes[0] === 'string';

    function updateSlider() {
      if (isSimpleArray) {
        img.src = imagenes[currentIndex];
        img.alt = `Slide ${currentIndex + 1}`;
        if (aboutText && descripcion && descripcion[currentIndex]) {
          aboutText.textContent = descripcion[currentIndex];
        }
      } else {
        img.src = imagenes[currentIndex].src || imagenes[currentIndex].image;
        img.alt = imagenes[currentIndex].alt || `Slide ${currentIndex + 1}`;
        if (aboutText && imagenes[currentIndex].text) {
          aboutText.textContent = imagenes[currentIndex].text;
        }
      }
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + imagenes.length) % imagenes.length;
      updateSlider();
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % imagenes.length;
      updateSlider();
    }

    // Event listeners
    prevBtn.addEventListener('click', prevImage);
    nextBtn.addEventListener('click', nextImage);

    // Autoplay
    if (autoplay) {
      let interval;

      function startAutoplay() {
        if (interval) clearInterval(interval);
        interval = setInterval(nextImage, autoplaySpeed || 3000);
      }

      startAutoplay();

      sliderContainer.addEventListener('mouseenter', () => {
        clearInterval(interval);
        interval = null;
      });

      sliderContainer.addEventListener('mouseleave', () => {
        startAutoplay();
      });

      window.addEventListener('beforeunload', () => {
        if (interval) clearInterval(interval);
      });
    }

    updateSlider();
  });
</script>
